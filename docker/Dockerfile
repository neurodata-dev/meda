# Commencing 
FROM ubuntu:16.04
MAINTAINER Jesse Patsolic <studiojlp@gmail.com>

RUN apt-get update && apt-get install -y openssh-server

RUN apt-get update
RUN apt-get install -y git libcurl4-openssl-dev libxml2-dev

RUN apt-get update
RUN apt-get install -y libssl-dev libssh2-1-dev 

####Install and compile R
RUN apt-get -y install r-base \
        r-base-dev

#### Install needed R libraries
RUN R -e "install.packages('devtools', repos = 'http://cran.rstudio.com/', dependencies = TRUE)"
RUN R -e "require(devtools); devtools::install_github('neurodata/meda', ref = '56da8cc6195a8eaa9c4d8e523256208834fde3a8', dependencies = TRUE)"
RUN R -e "source('https://bioconductor.org/biocLite.R'); biocLite('rhdf5')"

## Install vim, wget and tmux
RUN apt-get update && apt-get install -y vim wget tmux

#### Add user
RUN useradd -ms /bin/bash meda 
RUN chown meda:meda /home/meda & addgroup meda staff

## A few more R libraries 
RUN R -e "install.packages(c('htmlwidgets', 'jsonlite', 'base64enc', 'png', 'viridis'),\
 repos = 'http://cran.rstudio.com/', dependencies = 'Depends')"

COPY ./launcher.sh /launcher.sh
COPY ./genData.R /home/meda/genData.R 
COPY ./genPlots.R /home/meda/genPlots.R 
RUN chmod +x /launcher.sh & \
    chmod +x /home/meda/genData.R & \
    chmod +x /home/meda/genPlots.R
RUN mkdir /data
RUN chown meda:meda -R /data
USER meda

#ENTRYPOINT ["Rscript", "/home/meda/genData.R"]
ENTRYPOINT ["/launcher.sh"]

